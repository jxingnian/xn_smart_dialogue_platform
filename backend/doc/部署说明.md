<!--
 * @Author: 星年 && j_xingnian@163.com
 * @Date: 2026-01-09 10:32:49
 * @LastEditors: xingnian j_xingnian@163.com
 * @LastEditTime: 2026-01-09 14:44:11
 * @FilePath: \xn_smart_dialogue_platform\backend\doc\部署说明.md
 * @Description: 
 * 
 * Copyright (c) 2026 by ${git_name_email}, All Rights Reserved. 
-->
# 知境中枢 - 后端服务部署说明

## 技术栈

- Python 3.10+
- FastAPI
- PostgreSQL + pgvector
- Redis
- MQTT (EMQX)

## 环境要求

- Python 3.10+
- PostgreSQL 16+（需安装 pgvector 扩展）
- Redis 7+
- EMQX 5+（MQTT Broker）

### 安装 Python 环境（Ubuntu）

```bash
sudo apt install -y python3.10-venv python-is-python3
```

## 部署步骤

1. 进入后端目录
```bash
cd backend
```

2. 创建虚拟环境
```bash
python -m venv venv
source venv/bin/activate
```

3. 安装依赖
```bash
pip install -r requirements.txt
```

4. 配置环境变量
```bash
cp .env.example .env
# 编辑 .env 文件，填写数据库、Redis、MQTT 等配置
```

5. 启动服务
```bash
uvicorn app.main:app --host 0.0.0.0 --port 8000
```

访问 `http://服务器IP:8000/docs` 查看 API 文档。

## 生产部署

TODO

## 宝塔部署

TODO

## Docker 部署

```bash
# 构建镜像
docker build -f doc/Dockerfile -t zhijing-backend .

# 运行容器
docker run -d --name zhijing-backend -p 8000:8000 zhijing-backend
```

## 环境变量说明

| 变量名 | 说明 | 默认值 |
|--------|------|--------|
| DATABASE_URL | PostgreSQL 连接地址 | postgresql+asyncpg://postgres:postgres@localhost:5432/zhijing |
| REDIS_URL | Redis 连接地址 | redis://localhost:6379/0 |
| MQTT_BROKER | MQTT Broker 地址 | localhost |
| MQTT_PORT | MQTT Broker 端口 | 1883 |
| DASHSCOPE_API_KEY | 通义千问 API Key | - |
| OLLAMA_BASE_URL | Ollama 服务地址 | http://localhost:11434 |
| SECRET_KEY | JWT 密钥 | 必须修改 |
| DEBUG | 调试模式 | true |
