<!--
 * @Author: 星年 && j_xingnian@163.com
 * @Date: 2026-01-09 10:44:02
 * @LastEditors: xingnian j_xingnian@163.com
 * @LastEditTime: 2026-01-09 10:46:33
 * @FilePath: \xn_smart_dialogue_platform\doc\部署指南.md
 * @Description: 
 * 
 * Copyright (c) 2026 by ${git_name_email}, All Rights Reserved. 
-->
# 知境中枢 - 部署指南

## 系统架构

```
┌─────────────────────────────────────────────────────────┐
│                    管理端 (Vue3)                         │
└─────────────────────────┬───────────────────────────────┘
                          │ HTTP
┌─────────────────────────▼───────────────────────────────┐
│                   后端服务 (FastAPI)                     │
└─────────────────────────┬───────────────────────────────┘
                          │
        ┌─────────────────┼─────────────────┐
        ▼                 ▼                 ▼
   PostgreSQL          Redis             EMQX
   (数据库)            (缓存)          (MQTT Broker)
```

## 部署步骤

### 1. 部署依赖服务

需要先安装以下服务：
- PostgreSQL 16+（需安装 pgvector 扩展）
- Redis 7+
- EMQX 5+（MQTT Broker）
- MinIO（可选，用于图像存储）

### 2. 部署后端服务

详见：[backend/doc/部署说明.md](../backend/doc/部署说明.md)

### 3. 部署前端管理端

详见：[admin-web/doc/部署说明.md](../admin-web/doc/部署说明.md)

### 4. 配置反向代理

使用 Nginx 或 NAS 自带的反向代理功能，将请求转发到对应服务：
- `/` → 前端静态文件
- `/api` → 后端服务（端口 8000）

## 端口说明

| 服务 | 默认端口 | 说明 |
|------|----------|------|
| 后端 API | 8000 | FastAPI 服务 |
| 前端 | 80/443 | Nginx 或其他 Web 服务器 |
| PostgreSQL | 5432 | 数据库 |
| Redis | 6379 | 缓存 |
| EMQX | 1883 | MQTT 通信 |
| EMQX 控制台 | 18083 | MQTT 管理界面 |
| MinIO | 9000/9001 | 对象存储 |

## 环境要求

### 最低配置
- CPU：2 核
- 内存：4GB
- 磁盘：50GB

### 推荐配置
- CPU：4 核
- 内存：8GB
- 磁盘：200GB+

## 常见问题

### 数据库连接失败
检查 PostgreSQL 是否启动，确认连接地址和密码是否正确。

### MQTT 设备无法连接
检查 EMQX 是否启动，确认防火墙是否放行 1883 端口。

### 前端页面空白
检查后端服务是否启动，确认反向代理配置是否正确。
